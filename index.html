<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è¥å…»å°ç®¡å®¶ - é¥®é£Ÿè®°å½• & ä½“é‡ç®¡ç†</title>
<!-- æ¡Œé¢å›¾æ ‡ & PWA é…ç½® -->
<link rel="apple-touch-icon" sizes="180x180" href="https://picsum.photos/id/1080/180/180">
<link rel="icon" type="image/png" sizes="192x192" href="https://picsum.photos/id/1080/192/192">
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi55Gc5YWG5bCR5bCu5ZOlIiwic2hvcnRfbmFtZSI6IuWRveWFpOWvueWKoCIsImljb25zIjpbeyJzcmMiOiJodHRwczovL3BpY3N1bS5waG90b3MvaWQvMTA4MC8xOTIvMTkyIiwic2l6ZSI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dLCJzdGFydF91cmwiOiIuLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmZGY2ZjkiLCJ0aGVtZV9jb2xvciI6IiNmZDc5YWMifQ==">
<meta name="theme-color" content="#ff7b9c">
<meta name="apple-mobile-web-app-status-bar-style" content="#ff7b9c">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
}
body {
  background: #fdf6f9;
  color: #333;
  padding: 1rem;
  max-width: 768px;
  margin: 0 auto;
  position: relative;
}

/* å¡é€šèƒŒæ™¯å°å…ƒç´  */
body::before {
  content: "ğŸ";
  position: fixed;
  top: 5%;
  left: 5%;
  font-size: 2rem;
  opacity: 0.2;
  z-index: -1;
}
body::after {
  content: "ğŸ¥¦";
  position: fixed;
  bottom: 10%;
  right: 8%;
  font-size: 2.2rem;
  opacity: 0.2;
  z-index: -1;
}

/* ä¸»ç•Œé¢ */
.header {
  text-align: center;
  margin: 1rem 0 1.5rem;
}
.header h1 {
  color: #ff7b9c;
  font-size: 1.7rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}
.header h1::before {
  content: "ğŸ½ï¸";
  font-size: 1.8rem;
}
.user-bar {
  text-align: right;
  margin-bottom: 1rem;
  font-size: 0.9rem;
  color: #666;
}
.user-bar span {
  color: #ff7b9c;
  font-weight: 500;
}

/* é€‰é¡¹å¡ - ç¡®ä¿ç‚¹å‡»å…‰æ ‡ */
.tabbar {
  display: flex;
  background: white;
  border-radius: 16px;
  overflow: hidden;
  margin-bottom: 1rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}
.tab {
  flex: 1;
  text-align: center;
  padding: 0.9rem 0.5rem;
  font-size: 0.95rem;
  cursor: pointer;
  color: #666;
  transition: all 0.2s ease;
}
.tab.active {
  background: #ff7b9c;
  color: white;
}
.tab:hover {
  background: #fef0f5;
}

/* å¡ç‰‡ */
.card {
  background: white;
  border-radius: 16px;
  padding: 1.2rem;
  margin-bottom: 1rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  position: relative;
}
.card::before {
  content: "";
  position: absolute;
  top: 10px;
  right: 12px;
  font-size: 1.5rem;
  opacity: 0.15;
}
.card-profile::before { content: "ğŸ‘¤"; }
.card-target::before { content: "ğŸ“Š"; }
.card-meal::before { content: "ğŸ½ï¸"; }
.card-search::before { content: "ğŸ”"; }
.card-food::before { content: "ğŸ¥—"; }
.card-total::before { content: "ğŸ“ˆ"; }
.card-weight::before { content: "âš–ï¸"; }
.card-report::before { content: "ğŸ“„"; }
.card-recipe::before { content: "ğŸ±"; }

.card h2 {
  font-size: 1.15rem;
  margin-bottom: 1rem;
  color: #444;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}
.card h2::before {
  content: "â€¢";
  color: #ff7b9c;
  font-size: 1.3rem;
}

.form-row {
  display: flex;
  gap: 0.6rem;
  margin-bottom: 0.9rem;
  flex-wrap: wrap;
}
.form-row input,
.form-row select {
  flex: 1;
  min-width: 100px;
  padding: 0.8rem;
  border: 1px solid #f0cde0;
  border-radius: 12px;
  font-size: 0.95rem;
  outline: none;
  transition: border 0.2s ease;
}
.form-row input:focus,
.form-row select:focus {
  border-color: #ff7b9c;
  box-shadow: 0 0 0 2px rgba(255,123,156,0.1);
}

/* æŒ‰é’®æ ·å¼ç»Ÿä¸€ - è¡¥å…¨å…‰æ ‡å’Œè¿‡æ¸¡ */
.btn-mini, .btn {
  cursor: pointer;
  transition: background 0.2s ease;
}
.btn-mini {
  padding: 0.6rem 0.9rem;
  font-size: 0.9rem;
  border-radius: 10px;
  border: none;
  background: #ff7b9c;
  color: white;
}
.btn-mini:hover {
  background: #ff6890;
}
.btn-mini.danger {
  background: #ff6b6b;
}
.btn-mini.danger:hover {
  background: #ff5555;
}

.info-row {
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
  color: #555;
}
.nutri-row {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  font-size: 0.95rem;
  color: #666;
  margin: 0.8rem 0;
}

/* æœç´¢è”æƒ³ */
.suggest {
  border: 1px solid #f0cde0;
  border-radius: 12px;
  margin-top: 0.7rem;
  max-height: 200px;
  overflow-y: auto;
}
.suggest-item {
  padding: 0.8rem;
  border-bottom: 1px solid #f8e4ef;
  cursor: pointer;
  font-size: 0.95rem;
}
.suggest-item:hover {
  background: #fff0f5;
}
.suggest-item:last-child {
  border-bottom: none;
}

/* æ”¶è— */
.fav-list {
  margin-top: 0.7rem;
}
.fav-item {
  display: flex;
  justify-content: space-between;
  padding: 0.7rem 0;
  border-bottom: 1px dashed #f0cde0;
  font-size: 0.95rem;
}
.fav-item .del {
  color: #ff6b6b;
  cursor: pointer;
  font-weight: bold;
}
.fav-item .del:hover {
  color: #ff5555;
}

/* é¤é£Ÿåˆ—è¡¨ */
.meal-list .item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.7rem 0;
  border-bottom: 1px dashed #f0cde0;
  font-size: 0.95rem;
}

/* è¿›åº¦æ¡ */
.progress-item {
  margin-bottom: 1rem;
}
.progress-item .text {
  font-size: 0.95rem;
  margin-bottom: 0.4rem;
  color: #555;
}
.progress-bar {
  width: 100%;
  height: 10px;
  background: #f8e4ef;
  border-radius: 5px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: #ff7b9c;
  border-radius: 5px;
  transition: width 0.3s ease;
}

/* æ¯é¤å¯¹æ¯” */
.meal-compare {
  margin-bottom: 0.9rem;
}
.meal-compare .text {
  font-size: 0.95rem;
  margin-bottom: 0.4rem;
  color: #555;
}

/* å›¾è¡¨ - ç¡®ä¿å®¹å™¨æ­£å¸¸ */
canvas {
  width: 100% !important;
  height: 190px !important;
  border-radius: 12px;
  margin-top: 0.7rem;
  background: #fdf6f9;
}

/* å†å²è®°å½• */
.history-item {
  display: flex;
  justify-content: space-between;
  padding: 0.7rem 0;
  border-bottom: 1px dashed #f0cde0;
  font-size: 0.95rem;
}

/* æŠ¥å‘Š */
.report {
  white-space: pre-line;
  font-size: 0.95rem;
  line-height: 1.6;
  background: #fdf6f9;
  padding: 1.2rem;
  border-radius: 12px;
  margin-top: 0.8rem;
  color: #444;
}

/* é£Ÿè°± */
.recipe-item {
  padding: 1rem;
  border-bottom: 1px dashed #f0cde0;
}
.recipe-item:last-child {
  border-bottom: none;
}
.recipe-item h3 {
  font-size: 1.05rem;
  margin-bottom: 0.5rem;
  color: #ff7b9c;
}
.recipe-item p {
  font-size: 0.95rem;
  color: #555;
  line-height: 1.5;
}

/* å†…å®¹åŒº - ç¡®ä¿åˆ‡æ¢æµç•… */
.tab-content {
  display: none;
  animation: fadeIn 0.3s ease;
}
.tab-content.show {
  display: block;
}
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* åˆ†äº«æŒ‰é’® - ä¼˜åŒ–hover */
.share-btn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #ff7b9c;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 4px 12px rgba(255,123,156,0.3);
  cursor: pointer;
  z-index: 100;
  transition: all 0.2s ease;
}
.share-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 15px rgba(255,123,156,0.4);
}

/* å…¨å±€æŒ‰é’®ç»Ÿä¸€hover */
button.btn {
  transition: background 0.2s ease;
}
button.btn:hover {
  background: #ff6890 !important;
}
button.btn.danger:hover {
  background: #ff5555 !important;
}
</style>
</head>
<body>

<!-- åˆ†äº«æŒ‰é’® -->
<div class="share-btn" onclick="shareApp()" title="åˆ†äº«ç»™å¥½å‹">ğŸ”—</div>

<!-- ä¸»ç•Œé¢ -->
<div class="header">
  <h1>è¥å…»å°ç®¡å®¶</h1>
</div>

<div class="tabbar">
  <div class="tab active" onclick="switchTab('diet')">é¥®é£Ÿè®°å½•</div>
  <div class="tab" onclick="switchTab('weight')">ä½“é‡å›¾è¡¨</div>
  <div class="tab" onclick="switchTab('report')">è¥å…»æŠ¥å‘Š</div>
  <div class="tab" onclick="switchTab('recipe')">é£Ÿè°±æ¨è</div>
</div>

<!-- ========== é¥®é£Ÿè®°å½• ========== -->
<div id="diet" class="tab-content show">
  <div class="card card-profile">
    <h2>ğŸ‘¤ ä¸ªäººä¿¡æ¯</h2>
    <div class="form-row">
      <select id="gender">
        <option value="male">ç”·</option>
        <option value="female" selected>å¥³</option>
      </select>
      <input type="number" id="age" placeholder="å¹´é¾„" value="25">
      <input type="number" id="height" placeholder="èº«é«˜(cm)" value="165">
      <input type="number" id="weight" placeholder="ä½“é‡(kg)" value="55">
    </div>
    <div class="form-row">
      <select id="activity">
        <option value="1.2">ä¹…å</option>
        <option value="1.375" selected>è½»åº¦æ´»åŠ¨</option>
        <option value="1.55">ä¸­åº¦æ´»åŠ¨</option>
        <option value="1.725">é«˜åº¦æ´»åŠ¨</option>
        <option value="1.9">æé«˜æ´»åŠ¨</option>
      </select>
      <select id="mode">
        <option value="maintain">ç»´æŒ</option>
        <option value="lose" selected>å‡è„‚</option>
        <option value="gain">å¢è‚Œ</option>
        <option value="pregnant">å­•å¦‡</option>
      </select>
    </div>
    <button class="btn" onclick="calcTarget()" style="width:100%;padding:0.9rem;border-radius:12px;background:#ff7b9c;color:white;border:none;font-weight:500;">è®¡ç®—æ¨èæ‘„å…¥</button>
  </div>

  <div class="card card-target" id="targetCard" style="display:none">
    <h2>ğŸ“Š æ¯æ—¥æ¨èç›®æ ‡</h2>
    <div class="info-row">åŸºç¡€ä»£è°¢ BMRï¼š<span id="bmr">0</span> kcal</div>
    <div class="info-row">æ¯æ—¥æ¶ˆè€— TDEEï¼š<span id="tdee">0</span> kcal</div>
    <div class="info-row">æ¨èçƒ­é‡ï¼š<span id="targetCal">0</span> kcal</div>
    <div class="info-row">è›‹ç™½è´¨ï¼š<span id="targetPro">0</span> g</div>
    <div class="info-row">è„‚è‚ªï¼š<span id="targetFat">0</span> g</div>
    <div class="info-row">ç¢³æ°´ï¼š<span id="targetCar">0</span> g</div>
  </div>

  <div class="card card-meal" id="mealSplitCard" style="display:none">
    <h2>ğŸ½ï¸ æ¯é¤åˆ†é… & æ‘„å…¥å¯¹æ¯”</h2>
    <div class="meal-compare">
      <div class="text">æ—©é¤ï¼š<span id="breakfastTotal">0</span> / <span id="breakfastTarget">0</span> kcal</div>
      <div class="progress-bar"><div class="progress-fill" id="breakfastPer" style="width:0%"></div></div>
    </div>
    <div class="meal-compare">
      <div class="text">åˆé¤ï¼š<span id="lunchTotal">0</span> / <span id="lunchTarget">0</span> kcal</div>
      <div class="progress-bar"><div class="progress-fill" id="lunchPer" style="width:0%"></div></div>
    </div>
    <div class="meal-compare">
      <div class="text">æ™šé¤ï¼š<span id="dinnerTotal">0</span> / <span id="dinnerTarget">0</span> kcal</div>
      <div class="progress-bar"><div class="progress-fill" id="dinnerPer" style="width:0%"></div></div>
    </div>
    <div class="meal-compare">
      <div class="text">åŠ é¤ï¼š<span id="snackTotal">0</span> / <span id="snackTarget">0</span> kcal</div>
      <div class="progress-bar"><div class="progress-fill" id="snackPer" style="width:0%"></div></div>
    </div>
  </div>

  <div class="card card-search">
    <h2>ğŸ” é£Ÿç‰©æœç´¢</h2>
    <div class="form-row">
      <input type="text" id="searchFood" placeholder="è¾“å…¥é£Ÿç‰©åï¼ˆæ”¯æŒæ‹¼éŸ³é¦–å­—æ¯ï¼‰" oninput="onSearchInput()">
      <button class="btn-mini" onclick="fillFood()">å¡«å……</button>
      <button class="btn-mini" onclick="toggleFav()">æ”¶è—</button>
    </div>
    <div id="suggest" class="suggest" style="display:none"></div>
    <div id="favList" class="fav-list" style="display:none"></div>
  </div>

  <div class="card card-food">
    <h2>ğŸ¥— é£Ÿç‰©å½•å…¥</h2>
   <div class="form-row">
  <input type="number" id="foodGram" placeholder="é‡é‡(g)" value="100" oninput="calcFoodByGram()">
</div>
    <div class="nutri-row">
      <span>çƒ­é‡ï¼š<span id="foodCal">0</span> kcal</span>
      <span>è›‹ç™½ï¼š<span id="foodPro">0</span> g</span>
      <span>è„‚è‚ªï¼š<span id="foodFat">0</span> g</span>
      <span>ç¢³æ°´ï¼š<span id="foodCar">0</span> g</span>
    </div>
    <div class="form-row">
      <button class="btn-mini" onclick="addMeal('breakfast')">åŠ æ—©é¤</button>
      <button class="btn-mini" onclick="addMeal('lunch')">åŠ åˆé¤</button>
      <button class="btn-mini" onclick="addMeal('dinner')">åŠ æ™šé¤</button>
      <button class="btn-mini" onclick="addMeal('snack')">åŠ åŠ é¤</button>
      <button class="btn-mini" onclick="addFav()">æ”¶è—å½“å‰</button>
    </div>
  </div>

  <div class="card">
    <h2>ğŸ¥ æ—©é¤</h2>
    <div id="breakfastList" class="meal-list"></div>
  </div>
  <div class="card">
    <h2>ğŸ± åˆé¤</h2>
    <div id="lunchList" class="meal-list"></div>
  </div>
  <div class="card">
    <h2>ğŸ² æ™šé¤</h2>
    <div id="dinnerList" class="meal-list"></div>
  </div>
  <div class="card">
    <h2>ğŸ åŠ é¤</h2>
    <div id="snackList" class="meal-list"></div>
  </div>

  <div class="card card-total" id="totalCard" style="display:none">
    <h2>ğŸ“ˆ ä»Šæ—¥æ‘„å…¥ / ç›®æ ‡</h2>
    <div class="progress-item">
      <div class="text">çƒ­é‡ï¼š<span id="totalCal">0</span> / <span id="totalCalTarget">0</span> kcal</div>
      <div class="progress-bar"><div class="progress-fill" id="totalCalPer" style="width:0%"></div></div>
    </div>
    <div class="progress-item">
      <div class="text">è›‹ç™½è´¨ï¼š<span id="totalPro">0</span> / <span id="totalProTarget">0</span> g</div>
      <div class="progress-bar"><div class="progress-fill" id="totalProPer" style="width:0%"></div></div>
    </div>
    <div class="progress-item">
      <div class="text">è„‚è‚ªï¼š<span id="totalFat">0</span> / <span id="totalFatTarget">0</span> g</div>
      <div class="progress-bar"><div class="progress-fill" id="totalFatPer" style="width:0%"></div></div>
    </div>
    <div class="progress-item">
      <div class="text">ç¢³æ°´ï¼š<span id="totalCar">0</span> / <span id="totalCarTarget">0</span> g</div>
      <div class="progress-bar"><div class="progress-fill" id="totalCarPer" style="width:0%"></div></div>
    </div>
  </div>

  <button class="btn danger" onclick="clearAll()" style="margin-bottom:2rem;width:100%;padding:0.9rem;border-radius:12px;background:#ff6b6b;color:white;border:none;font-weight:500;">æ¸…ç©ºä»Šæ—¥è®°å½•</button>
</div>

<!-- ========== ä½“é‡å›¾è¡¨ ========== -->
<div id="weight" class="tab-content">
  <div class="card card-weight">
    <h2>âœï¸ ä»Šæ—¥ä½“é‡</h2>
    <div class="form-row">
      <input type="number" step="0.1" id="todayWeight" placeholder="ä½“é‡(kg)">
      <button class="btn" onclick="saveWeight()" style="padding:0.8rem 1.2rem;border-radius:12px;background:#ff7b9c;color:white;border:none;font-weight:500;">ä¿å­˜</button>
    </div>
  </div>
  <div class="card">
    <h2>ğŸ“… ä½“é‡è¶‹åŠ¿ï¼ˆè¿‘30å¤©ï¼‰</h2>
    <canvas id="weightChart"></canvas>
  </div>
  <div class="card">
    <h2>ğŸ“‹ å†å²è®°å½•</h2>
    <div id="weightHistory" style="min-height: 60px; display: flex; align-items: center; justify-content: center; color: #999;">
      æš‚æ— ä½“é‡è®°å½•ï¼Œæ·»åŠ åè‡ªåŠ¨å±•ç¤ºè¶‹åŠ¿å’Œå†å²
    </div>
  </div>
</div>

<!-- ========== è¥å…»æŠ¥å‘Š ========== -->
<div id="report" class="tab-content">
  <div class="card card-report">
    <h2>ğŸ“„ ä»Šæ—¥è¥å…»åˆ†ææŠ¥å‘Š</h2>
    <div id="reportContent" class="report">è¯·å…ˆåœ¨ã€é¥®é£Ÿè®°å½•ã€‘ä¸­è®¡ç®—æ¨èç›®æ ‡å¹¶è®°å½•ä»Šæ—¥é¥®é£Ÿï¼Œå†ç”Ÿæˆåˆ†ææŠ¥å‘Š</div>
    <button class="btn" onclick="genReport()" style="width:100%;margin-top:1rem;padding:0.9rem;border-radius:12px;background:#ff7b9c;color:white;border:none;font-weight:500;">ç”ŸæˆæŠ¥å‘Š</button>
  </div>
</div>

<!-- ========== é£Ÿè°±æ¨è ========== -->
<div id="recipe" class="tab-content">
  <div class="card card-recipe">
    <h2>ğŸ± ä¸ªæ€§åŒ–é£Ÿè°±æ¨è</h2>
    <div id="recipeList"></div>
    <button class="btn" onclick="genRecipe()" style="width:100%;margin-top:1rem;padding:0.9rem;border-radius:12px;background:#ff7b9c;color:white;border:none;font-weight:500;">åˆ·æ–°æ¨è</button>
  </div>
</div>

<script>
// ==============================
// å†…ç½®é£Ÿç‰©åº“ - ä¿®å¤é‡å¤const
// ==============================
const FOOD_DB = {
  // ä¸»é£Ÿç±»
  "ç™½ç±³é¥­": { cal: 116, pro: 2.6, fat: 0.3, car: 25.9 },
  "ç³™ç±³é¥­": { cal: 110, pro: 2.6, fat: 0.9, car: 23.8 },
  "é»‘ç±³é¥­": { cal: 112, pro: 3.0, fat: 1.0, car: 24.2 },
  "ç‡•éº¦é¥­": { cal: 105, pro: 3.5, fat: 1.5, car: 21.0 },
  "å°ç±³é¥­": { cal: 116, pro: 3.5, fat: 1.2, car: 24.0 },
  "è—œéº¦é¥­": { cal: 120, pro: 4.4, fat: 1.5, car: 21.3 },
  "é¦’å¤´": { cal: 223, pro: 7.0, fat: 1.1, car: 45.7 },
  "å…¨éº¦é¦’å¤´": { cal: 190, pro: 8.0, fat: 1.5, car: 39.0 },
  "èŠ±å·": { cal: 211, pro: 6.5, fat: 1.0, car: 43.0 },
  "é¢æ¡(ç†Ÿ)": { cal: 110, pro: 2.7, fat: 0.2, car: 23.5 },
  "å…¨éº¦é¢æ¡": { cal: 125, pro: 4.5, fat: 1.5, car: 23.0 },
  "æ„é¢(ç†Ÿ)": { cal: 130, pro: 5.0, fat: 1.0, car: 25.0 },
  "èéº¦é¢": { cal: 100, pro: 3.5, fat: 0.8, car: 20.0 },
  "ç™½é¢åŒ…": { cal: 265, pro: 8.0, fat: 3.2, car: 49.0 },
  "å…¨éº¦é¢åŒ…": { cal: 240, pro: 9.0, fat: 3.5, car: 42.0 },
  "åå¸": { cal: 250, pro: 8.5, fat: 3.0, car: 47.0 },
  "æ³•æ£": { cal: 280, pro: 8.0, fat: 1.5, car: 55.0 },
  "è´æœ": { cal: 250, pro: 9.0, fat: 1.0, car: 50.0 },
  "ç‰ç±³(é²œ)": { cal: 96, pro: 3.4, fat: 1.5, car: 19.0 },
  "çº¢è–¯": { cal: 86, pro: 1.6, fat: 0.1, car: 20.1 },
  "ç´«è–¯": { cal: 86, pro: 1.6, fat: 0.1, car: 20.0 },
  "å±±è¯": { cal: 57, pro: 1.9, fat: 0.2, car: 12.4 },
  "èŠ‹å¤´": { cal: 77, pro: 2.2, fat: 0.2, car: 18.1 },
  "åœŸè±†": { cal: 77, pro: 2.0, fat: 0.2, car: 17.2 },
  "è²è—•": { cal: 70, pro: 2.6, fat: 0.1, car: 15.2 },
  "å—ç“œ": { cal: 26, pro: 1.0, fat: 0.1, car: 6.5 },
  // è‚‰è›‹ç±»
  "é¸¡èƒ¸è‚‰": { cal: 118, pro: 23.1, fat: 2.2, car: 0 },
  "é¸¡è…¿è‚‰(å»çš®)": { cal: 130, pro: 21.0, fat: 4.5, car: 0 },
  "ç«é¸¡èƒ¸è‚‰": { cal: 105, pro: 23.0, fat: 1.0, car: 0 },
  "ç˜¦ç‰›è‚‰": { cal: 125, pro: 20.2, fat: 4.2, car: 1.3 },
  "ç‰›é‡Œè„Š": { cal: 105, pro: 22.0, fat: 1.5, car: 0 },
  "ç˜¦çŒªè‚‰": { cal: 143, pro: 20.3, fat: 6.2, car: 0 },
  "çŒªé‡Œè„Š": { cal: 110, pro: 21.5, fat: 2.0, car: 0 },
  "ç¾Šè‚‰(ç˜¦)": { cal: 118, pro: 20.5, fat: 3.5, car: 0 },
  "çŒªè‚": { cal: 130, pro: 19.3, fat: 3.5, car: 5.0 },
  "é¸¡è‚": { cal: 120, pro: 17.0, fat: 4.8, car: 2.0 },
  "é¸¡è›‹": { cal: 143, pro: 12.6, fat: 9.9, car: 1.5 },
  "è›‹æ¸…": { cal: 52, pro: 11.6, fat: 0.1, car: 1.1 },
  "è›‹é»„": { cal: 323, pro: 15.9, fat: 26.5, car: 3.5 },
  "é¸­è›‹": { cal: 130, pro: 12.0, fat: 8.7, car: 2.0 },
  "é¹Œé¹‘è›‹": { cal: 160, pro: 12.8, fat: 11.0, car: 2.1 },
  // æ°´äº§ç±»
  "ä¸‰æ–‡é±¼": { cal: 142, pro: 20.8, fat: 6.3, car: 0 },
  "é‡‘æªé±¼(æ°´æµ¸)": { cal: 110, pro: 23.5, fat: 1.0, car: 0 },
  "é³•é±¼": { cal: 82, pro: 17.8, fat: 0.7, car: 0 },
  "é¾™åˆ©é±¼": { cal: 85, pro: 18.0, fat: 1.0, car: 0 },
  "å·´æ²™é±¼": { cal: 85, pro: 18.0, fat: 1.0, car: 0 },
  "é²ˆé±¼": { cal: 105, pro: 18.6, fat: 3.4, car: 0 },
  "é²«é±¼": { cal: 110, pro: 17.1, fat: 4.0, car: 3.0 },
  "è‰é±¼": { cal: 112, pro: 16.6, fat: 5.2, car: 0 },
  "è™¾(é²œ)": { cal: 85, pro: 18.0, fat: 1.0, car: 0 },
  "è™¾ä»": { cal: 80, pro: 17.5, fat: 0.8, car: 0 },
  "æ‰‡è´è‚‰": { cal: 60, pro: 12.0, fat: 0.5, car: 2.0 },
  "èŠ±è›¤": { cal: 62, pro: 10.0, fat: 1.0, car: 2.0 },
  "é±¿é±¼": { cal: 75, pro: 17.0, fat: 1.0, car: 2.0 },
  "æµ·å‚": { cal: 26, pro: 5.0, fat: 0.1, car: 0 },
  // è±†åˆ¶å“
  "è±†è…(åŒ—)": { cal: 76, pro: 8.1, fat: 4.8, car: 2.8 },
  "è±†è…(å—)": { cal: 60, pro: 6.0, fat: 3.5, car: 2.0 },
  "å«©è±†è…": { cal: 55, pro: 5.5, fat: 3.0, car: 1.5 },
  "å†»è±†è…": { cal: 100, pro: 10.0, fat: 5.0, car: 3.0 },
  "åƒå¼ /è±†çš®": { cal: 260, pro: 24.0, fat: 18.0, car: 5.0 },
  "è…ç«¹": { cal: 460, pro: 44.0, fat: 22.0, car: 20.0 },
  "è±†å¹²": { cal: 140, pro: 16.0, fat: 6.0, car: 4.0 },
  "ç´ é¸¡": { cal: 190, pro: 17.0, fat: 12.0, car: 4.0 },
  "è±†æµ†(æ— ç³–)": { cal: 30, pro: 2.5, fat: 1.0, car: 1.5 },
  "è±†è…è„‘(æ— ç³–)": { cal: 15, pro: 1.5, fat: 0.5, car: 1.0 },
  // å¥¶ç±»
  "å…¨è„‚ç‰›å¥¶": { cal: 62, pro: 3.2, fat: 3.2, car: 4.8 },
  "ä½è„‚ç‰›å¥¶": { cal: 43, pro: 3.4, fat: 1.0, car: 5.0 },
  "è„±è„‚ç‰›å¥¶": { cal: 35, pro: 3.4, fat: 0.1, car: 5.0 },
  "æ— ç³–é…¸å¥¶": { cal: 72, pro: 4.0, fat: 1.5, car: 7.0 },
  "å…¨è„‚é…¸å¥¶": { cal: 90, pro: 3.5, fat: 4.0, car: 9.0 },
  "å¸Œè…Šé…¸å¥¶(æ— ç³–)": { cal: 100, pro: 10.0, fat: 0.5, car: 6.0 },
  "å¥¶é…ª(ä½è„‚)": { cal: 180, pro: 20.0, fat: 10.0, car: 1.0 },
  "å¥¶æ²¹å¥¶é…ª": { cal: 350, pro: 8.0, fat: 34.0, car: 2.0 },
  // è”¬èœç±»
  "è¥¿å…°èŠ±": { cal: 34, pro: 2.8, fat: 0.4, car: 6.6 },
  "è èœ": { cal: 23, pro: 2.9, fat: 0.4, car: 3.6 },
  "ç”Ÿèœ": { cal: 15, pro: 1.0, fat: 0.1, car: 2.0 },
  "æ²¹éº¦èœ": { cal: 15, pro: 1.2, fat: 0.2, car: 2.0 },
  "å°ç™½èœ": { cal: 15, pro: 1.5, fat: 0.2, car: 2.0 },
  "ä¸Šæµ·é’": { cal: 15, pro: 1.5, fat: 0.2, car: 2.0 },
  "ç©ºå¿ƒèœ": { cal: 20, pro: 1.8, fat: 0.2, car: 3.0 },
  "èŠ¹èœ": { cal: 16, pro: 0.8, fat: 0.1, car: 3.0 },
  "éŸ­èœ": { cal: 25, pro: 2.0, fat: 0.3, car: 4.0 },
  "é»„ç“œ": { cal: 15, pro: 0.6, fat: 0.2, car: 2.9 },
  "å†¬ç“œ": { cal: 12, pro: 0.4, fat: 0.1, car: 2.6 },
  "ä¸ç“œ": { cal: 20, pro: 1.0, fat: 0.2, car: 4.0 },
  "è‹¦ç“œ": { cal: 19, pro: 1.0, fat: 0.1, car: 4.0 },
  "ç•ªèŒ„": { cal: 18, pro: 0.9, fat: 0.2, car: 3.9 },
  "åœ£å¥³æœ": { cal: 22, pro: 1.0, fat: 0.2, car: 4.8 },
  "èŒ„å­": { cal: 25, pro: 1.1, fat: 0.2, car: 5.0 },
  "å½©æ¤’": { cal: 26, pro: 1.3, fat: 0.2, car: 5.5 },
  "é’æ¤’": { cal: 22, pro: 1.1, fat: 0.2, car: 4.5 },
  "é‡‘é’ˆè‡": { cal: 32, pro: 2.4, fat: 0.4, car: 6.0 },
  "é¦™è‡": { cal: 26, pro: 2.2, fat: 0.3, car: 5.0 },
  "æé²è‡": { cal: 31, pro: 1.3, fat: 0.1, car: 6.0 },
  "æœ¨è€³(å¹²)": { cal: 250, pro: 10.0, fat: 0.5, car: 60.0 },
  "æµ·å¸¦": { cal: 13, pro: 0.9, fat: 0.2, car: 2.5 },
  "ç´«èœ(å¹²)": { cal: 200, pro: 15.0, fat: 1.0, car: 40.0 },
  "èŠ¦ç¬‹": { cal: 20, pro: 2.2, fat: 0.2, car: 3.8 },
  "ç«¹ç¬‹": { cal: 23, pro: 2.6, fat: 0.2, car: 3.5 },
  "èŒ­ç™½": { cal: 23, pro: 1.8, fat: 0.2, car: 4.0 },
  "å¨ƒå¨ƒèœ": { cal: 13, pro: 1.2, fat: 0.1, car: 2.5 },
  "èŒ¼è’¿": { cal: 18, pro: 1.9, fat: 0.3, car: 3.0 },
  // æ°´æœç±»
  "è‹¹æœ": { cal: 52, pro: 0.3, fat: 0.2, car: 13.8 },
  "æ¢¨": { cal: 57, pro: 0.3, fat: 0.2, car: 15.2 },
  "é¦™è•‰": { cal: 89, pro: 1.1, fat: 0.3, car: 22.8 },
  "æ©™å­": { cal: 47, pro: 1.0, fat: 0.2, car: 11.8 },
  "æ©˜å­": { cal: 43, pro: 0.8, fat: 0.1, car: 10.0 },
  "æŸšå­": { cal: 38, pro: 0.7, fat: 0.1, car: 9.5 },
  "è‘¡è„": { cal: 69, pro: 0.7, fat: 0.2, car: 18.0 },
  "æå­": { cal: 65, pro: 0.7, fat: 0.2, car: 17.0 },
  "è‰è“": { cal: 32, pro: 0.7, fat: 0.3, car: 7.7 },
  "è“è“": { cal: 57, pro: 0.7, fat: 0.3, car: 14.5 },
  "çŒ•çŒ´æ¡ƒ": { cal: 61, pro: 1.1, fat: 0.5, car: 14.7 },
  "ç«é¾™æœ(ç™½)": { cal: 51, pro: 1.1, fat: 0.2, car: 13.0 },
  "ç«é¾™æœ(çº¢)": { cal: 55, pro: 1.2, fat: 0.3, car: 13.5 },
  "èŠ’æœ": { cal: 60, pro: 0.8, fat: 0.2, car: 15.0 },
  "æœ¨ç“œ": { cal: 39, pro: 0.5, fat: 0.1, car: 10.0 },
  "è è": { cal: 50, pro: 0.8, fat: 0.1, car: 13.0 },
  "è¥¿ç“œ": { cal: 30, pro: 0.6, fat: 0.1, car: 7.6 },
  "å“ˆå¯†ç“œ": { cal: 34, pro: 0.5, fat: 0.1, car: 8.0 },
  "æ¡ƒå­": { cal: 40, pro: 0.7, fat: 0.2, car: 10.0 },
  "æå­": { cal: 39, pro: 0.7, fat: 0.2, car: 9.5 },
  "æå­": { cal: 48, pro: 1.0, fat: 0.2, car: 11.0 },
  "å¤§æ£(é²œ)": { cal: 125, pro: 1.0, fat: 0.2, car: 30.5 },
  "å†¬æ£": { cal: 110, pro: 1.0, fat: 0.2, car: 27.0 },
  "å±±æ¥‚": { cal: 95, pro: 0.5, fat: 0.2, car: 24.0 },
  "çŸ³æ¦´": { cal: 83, pro: 1.4, fat: 0.3, car: 18.7 },
  "æŸ¿å­": { cal: 71, pro: 0.5, fat: 0.1, car: 18.5 },
  "æŸ æª¬": { cal: 29, pro: 1.1, fat: 0.3, car: 9.0 },
  "ç™¾é¦™æœ": { cal: 97, pro: 2.2, fat: 0.7, car: 23.0 },
  "ç‰›æ²¹æœ": { cal: 160, pro: 2.0, fat: 15.0, car: 8.5 },
  "æ¤°å­è‚‰": { cal: 354, pro: 4.0, fat: 33.0, car: 15.0 },
  // åšæœç§å­
  "æä»": { cal: 579, pro: 21.1, fat: 49.9, car: 14.3 },
  "å·´æ—¦æœ¨": { cal: 575, pro: 21.0, fat: 49.0, car: 14.0 },
  "æ ¸æ¡ƒ": { cal: 654, pro: 15.2, fat: 65.2, car: 13.9 },
  "è…°æœ": { cal: 553, pro: 18.2, fat: 43.8, car: 27.0 },
  "å¼€å¿ƒæœ": { cal: 560, pro: 20.0, fat: 45.0, car: 17.0 },
  "å¤å¨å¤·æœ": { cal: 718, pro: 7.9, fat: 76.0, car: 10.0 },
  "æ¾å­": { cal: 673, pro: 14.0, fat: 70.0, car: 13.0 },
  "èŠ±ç”Ÿ(ç”Ÿ)": { cal: 567, pro: 25.8, fat: 49.2, car: 16.1 },
  "èŠ±ç”Ÿ(ç†Ÿ)": { cal: 580, pro: 26.0, fat: 50.0, car: 16.5 },
  "å—ç“œå­": { cal: 559, pro: 30.2, fat: 45.0, car: 11.0 },
  "è‘µèŠ±ç±½": { cal: 584, pro: 21.0, fat: 51.0, car: 13.0 },
  "èŠéº»(ç™½)": { cal: 575, pro: 18.0, fat: 50.0, car: 18.0 },
  "èŠéº»(é»‘)": { cal: 580, pro: 19.0, fat: 50.0, car: 18.0 },
  "å¥‡äºšç±½": { cal: 480, pro: 17.0, fat: 31.0, car: 38.0 },
  "äºšéº»ç±½": { cal: 534, pro: 18.0, fat: 42.0, car: 29.0 },
  // é›¶é£Ÿ/å…¶ä»–
  "é»‘å·§å…‹åŠ›(85%+)": { cal: 604, pro: 8.0, fat: 43.0, car: 25.0 },
  "ç‰›å¥¶å·§å…‹åŠ›": { cal: 539, pro: 6.0, fat: 31.0, car: 57.0 },
  "ç™½å·§å…‹åŠ›": { cal: 545, pro: 5.0, fat: 33.0, car: 59.0 },
  "æœå†»(æ— ç³–)": { cal: 10, pro: 0.1, fat: 0, car: 2.5 },
  "æµ·è‹”(åŸå‘³)": { cal: 30, pro: 3.0, fat: 0.5, car: 5.0 },
  "çˆ†ç±³èŠ±(æ— æ²¹)": { cal: 380, pro: 12.0, fat: 4.0, car: 78.0 },
  "è–¯ç‰‡(åŸå‘³)": { cal: 536, pro: 7.0, fat: 35.0, car: 53.0 },
  "è‹æ‰“é¥¼å¹²": { cal: 408, pro: 8.0, fat: 11.0, car: 71.0 },
  "å¨åŒ–é¥¼å¹²": { cal: 500, pro: 5.0, fat: 25.0, car: 65.0 },
  "æ›²å¥‡é¥¼å¹²": { cal: 505, pro: 6.0, fat: 26.0, car: 63.0 },
  "éº¦èŠ½ç³–": { cal: 320, pro: 0, fat: 0, car: 82.0 },
  "èœ‚èœœ": { cal: 304, pro: 0.3, fat: 0, car: 82.4 },
  "ç™½ç ‚ç³–": { cal: 400, pro: 0, fat: 0, car: 100.0 },
  "å†°ç³–": { cal: 395, pro: 0, fat: 0, car: 99.0 },
  "çº¢ç³–": { cal: 385, pro: 0.1, fat: 0, car: 97.0 },
  // æ²¹è„‚ç±»
  "æ©„æ¦„æ²¹": { cal: 890, pro: 0, fat: 100.0, car: 0 },
  "èœç±½æ²¹": { cal: 890, pro: 0, fat: 100.0, car: 0 },
  "èŠ±ç”Ÿæ²¹": { cal: 890, pro: 0, fat: 100.0, car: 0 },
  "ç‰ç±³æ²¹": { cal: 890, pro: 0, fat: 100.0, car: 0 },
  "é»„æ²¹": { cal: 717, pro: 0.5, fat: 81.0, car: 0.1 },
  "æ¤°å­æ²¹": { cal: 890, pro: 0, fat: 100.0, car: 0 },
  "æ²™æ‹‰é…±(ä½è„‚)": { cal: 250, pro: 1.0, fat: 20.0, car: 15.0 },
  "è›‹é»„é…±": { cal: 680, pro: 1.0, fat: 75.0, car: 0.5 },
  "ç•ªèŒ„é…±": { cal: 100, pro: 1.0, fat: 0.1, car: 24.0 },
  "è±†ç“£é…±": { cal: 130, pro: 6.0, fat: 7.0, car: 10.0 },
  "ç”ŸæŠ½": { cal: 20, pro: 2.5, fat: 0.1, car: 2.0 },
  "è€æŠ½": { cal: 15, pro: 2.0, fat: 0.1, car: 1.5 },
  "é†‹": { cal: 30, pro: 0.1, fat: 0, car: 7.0 },
  // é€Ÿé£Ÿ/åŠ å·¥
  "å³é£Ÿé¸¡èƒ¸è‚‰": { cal: 110, pro: 22.0, fat: 2.0, car: 0 },
  "å³é£Ÿç‰›è‚‰": { cal: 120, pro: 20.0, fat: 4.0, car: 0 },
  "å³é£Ÿè™¾ä»": { cal: 80, pro: 17.0, fat: 1.0, car: 0 },
  "å³é£Ÿç‡•éº¦": { cal: 380, pro: 13.0, fat: 8.0, car: 65.0 },
  "å…¨éº¦éº¦ç‰‡": { cal: 370, pro: 12.0, fat: 7.0, car: 64.0 },
  "ç‰ç±³ç‰‡(åŸå‘³)": { cal: 370, pro: 7.0, fat: 3.0, car: 80.0 },
  "é­”èŠ‹ä¸": { cal: 10, pro: 0.2, fat: 0, car: 2.0 },
  "é­”èŠ‹ç»“": { cal: 10, pro: 0.2, fat: 0, car: 2.0 },
  "è±†è…ä¸": { cal: 250, pro: 22.0, fat: 17.0, car: 4.0 },
  "ç´ æ¯›è‚š": { cal: 15, pro: 1.0, fat: 0.5, car: 2.0 }
};
const FOOD_NAMES = Object.keys(FOOD_DB);
// ==============================
// å…¨å±€çŠ¶æ€ï¼ˆç›´æ¥åŠ è½½ï¼Œæ— ç™»å½•ï¼‰
// ==============================
let state = {
  profile: { gender: 'female', age: 25, height: 165, weight: 55, activity: 1.375, mode: 'lose' },
  target: { bmr: 0, tdee: 0, cal: 0, pro: 0, fat: 0, car: 0 },
  mealSplit: { breakfast: 0, lunch: 0, dinner: 0, snack: 0 },
  foodData: { breakfast: [], lunch: [], dinner: [], snack: [] },
  total: { cal: 0, pro: 0, fat: 0, car: 0 },
  favList: JSON.parse(localStorage.getItem('favList') || '[]'),
  weightList: JSON.parse(localStorage.getItem('weightList') || '[]'),
  currentFood: { name: '', gram: 100, cal: 0, pro: 0, fat: 0, car: 0 }
};

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ– - ä¿®å¤æ ‡ç­¾+åŠ è½½æ•°æ®+åˆå§‹åŒ–é£Ÿè°±
window.onload = function() {
  loadState();
  genRecipe(); // é¡µé¢åŠ è½½å°±ç”Ÿæˆé»˜è®¤é£Ÿè°±
  renderWeightHistory(); // åˆå§‹åŒ–ä½“é‡å†å²å±•ç¤º
};

// ==============================
// åˆ†äº«åŠŸèƒ½
// ==============================
function shareApp() {
  const url = window.location.href;
  if (navigator.share) {
    navigator.share({
      title: 'è¥å…»å°ç®¡å®¶ - é¥®é£Ÿè®°å½• & ä½“é‡ç®¡ç†',
      text: 'è¶…å¥½ç”¨çš„é¥®é£Ÿè¥å…»è®¡ç®—å™¨ï¼Œç²¾å‡†ç®¡ç†å‡è„‚/å¢è‚Œ/æ—¥å¸¸é¥®é£Ÿï¼Œå¿«æ¥è¯•è¯•å§ï¼',
      url: url
    }).catch(err => {
      copyToClipboard(url);
    });
  } else {
    copyToClipboard(url);
  }
}

function copyToClipboard(text) {
  const input = document.createElement('input');
  input.value = text;
  document.body.appendChild(input);
  input.select();
  document.execCommand('copy');
  document.body.removeChild(input);
  alert('é“¾æ¥å·²å¤åˆ¶ï¼Œå¯ç›´æ¥åˆ†äº«ç»™å¥½å‹ï¼');
}

// ==============================
// é€‰é¡¹å¡åˆ‡æ¢ - æ ¸å¿ƒä¿®å¤ï¼šæ ‡ç­¾ç´¢å¼•è®¡ç®—é”™è¯¯
// ==============================
function switchTab(tab) {
  // ç§»é™¤æ‰€æœ‰æ ‡ç­¾å’Œå†…å®¹çš„æ¿€æ´»çŠ¶æ€
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('show'));
  document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
  // æ¿€æ´»å½“å‰æ ‡ç­¾å’Œå†…å®¹
  document.getElementById(tab).classList.add('show');
  // ç²¾å‡†åŒ¹é…æ ‡ç­¾ç´¢å¼•ï¼šdiet=1, weight=2, report=3, recipe=4
  let tabIndex = 1;
  if (tab === 'weight') tabIndex = 2;
  else if (tab === 'report') tabIndex = 3;
  else if (tab === 'recipe') tabIndex = 4;
  document.querySelector(`.tab:nth-child(${tabIndex})`).classList.add('active');
  // åˆ‡æ¢åˆ°ä½“é‡æ ‡ç­¾æ—¶æ¸²æŸ“å›¾è¡¨
  if (tab === 'weight') drawWeightChart();
}

// ==============================
// æœç´¢è”æƒ³ï¼ˆä¼˜åŒ–ç‰ˆï¼Œæ”¯æŒæ‹¼éŸ³é¦–å­—æ¯ï¼‰
// ==============================
function onSearchInput() {
  const key = document.getElementById('searchFood').value.trim().toLowerCase();
  const suggestEl = document.getElementById('suggest');
  if (!key) {
    suggestEl.style.display = 'none';
    return;
  }
  // æ‹¼éŸ³é¦–å­—æ¯æ˜ å°„ï¼ˆåªè¦†ç›–å¸¸ç”¨ï¼Œå¤Ÿç”¨ï¼‰
  const pinyinMap = {
    'm': 'ç±³', 'f': 'é¥­', 'mi': 'é¢', 't': 'ç³–', 'y': 'é±¼', 'j': 'é¸¡', 'niu': 'ç‰›', 'zhu': 'çŒª',
    'd': 'è›‹', 'dou': 'è±†', 'tu': 'åœŸ', 'yu': 'ç‰', 'xiang': 'é¦™', 'qin': 'èŠ¹', 'b': 'ç™½', 'h': 'çº¢',
    's': 'ä¸‰', 'lan': 'è“', 'c': 'èœ', 'g': 'ç“œ', 'shui': 'æ°´', 'guo': 'æœ', 'n': 'å¥¶', 'you': 'æ²¹'
  };
  // åŒ¹é…é€»è¾‘ï¼šåŒ…å«å…³é”®è¯ æˆ– æ‹¼éŸ³é¦–å­—æ¯åŒ¹é…
  const list = FOOD_NAMES.filter(name => {
    const lowerName = name.toLowerCase();
    if (lowerName.includes(key)) return true;
    for (const p in pinyinMap) {
      if (key === p && lowerName.includes(pinyinMap[p])) return true;
    }
    return false;
  }).slice(0, 8);
  suggestEl.innerHTML = list.map(name => `
    <div class="suggest-item" onclick="selectFood('${name}')">${name}</div>
  `).join('');
  suggestEl.style.display = 'block';
}

function selectFood(name) {
  document.getElementById('searchFood').value = name;
  document.getElementById('suggest').style.display = 'none';
  state.currentFood.name = name;
  // é€‰å®Œè‡ªåŠ¨é‡æ–°è®¡ç®—å…‹é‡
  calcFoodByGram();
}

// ==============================
// å¡«å……è¥å…»
// ==============================
// ç‚¹å‡»â€œå¡«å……â€æ—¶ï¼Œåªè®°å½•é£Ÿç‰©åç§°ï¼Œç„¶åè‡ªåŠ¨ç®—å…‹é‡
function fillFood() {
  const name = document.getElementById('searchFood').value.trim();
  if (!name || !FOOD_DB[name]) {
    alert('æœªæ‰¾åˆ°è¯¥é£Ÿç‰©ï¼Œè¯·æ£€æŸ¥åç§°æ˜¯å¦æ­£ç¡®');
    return;
  }
  state.currentFood.name = name;
  calcFoodByGram(); // è°ƒç”¨è‡ªåŠ¨æ¢ç®—
}

// æŒ‰å…‹è‡ªåŠ¨å®æ—¶æ¢ç®—è¥å…»å€¼ï¼ˆè¾“å…¥å…‹é‡æ—¶è‡ªåŠ¨è§¦å‘ï¼‰
function calcFoodByGram() {
  const name = state.currentFood.name;
  const gram = parseInt(document.getElementById('foodGram').value) || 100;

  if (!name || !FOOD_DB[name]) return;

  const base = FOOD_DB[name];
  const cal = Math.round(base.cal * gram / 100);
  const pro = (base.pro * gram / 100).toFixed(1);
  const fat = (base.fat * gram / 100).toFixed(1);
  const car = (base.car * gram / 100).toFixed(1);

  state.currentFood = { name, gram, cal, pro, fat, car };

  // æŠŠç®—å¥½çš„å€¼æ˜¾ç¤ºåˆ°é¡µé¢
  document.getElementById('foodCal').textContent = cal;
  document.getElementById('foodPro').textContent = pro;
  document.getElementById('foodFat').textContent = fat;
  document.getElementById('foodCar').textContent = car;
}

// ==============================
// æ”¶è—
// ==============================
function toggleFav() {
  const el = document.getElementById('favList');
  el.style.display = el.style.display === 'none' ? 'block' : 'none';
  renderFav();
}

function renderFav() {
  const el = document.getElementById('favList');
  if (state.favList.length === 0) {
    el.innerHTML = '<div style="padding:0.8rem;text-align:center;color:#999;">æš‚æ— æ”¶è—é£Ÿç‰©</div>';
    return;
  }
  el.innerHTML = state.favList.map(name => `
    <div class="fav-item">
      <span onclick="selectFood('${name}');fillFood()">${name}</span>
      <span class="del" onclick="delFav('${name}')">Ã—</span>
    </div>
  `).join('');
}

function addFav() {
  const name = state.currentFood.name;
  if (!name || !FOOD_DB[name]) {
    alert('è¯·å…ˆé€‰æ‹©å¹¶å¡«å……æœ‰æ•ˆé£Ÿç‰©');
    return;
  }
  if (state.favList.includes(name)) {
    alert('è¯¥é£Ÿç‰©å·²åŠ å…¥æ”¶è—å¤¹');
    return;
  }
  state.favList.push(name);
  localStorage.setItem('favList', JSON.stringify(state.favList));
  renderFav();
  alert('æ”¶è—æˆåŠŸï¼');
}

function delFav(name) {
  state.favList = state.favList.filter(n => n !== name);
  localStorage.setItem('favList', JSON.stringify(state.favList));
  renderFav();
}

// ==============================
// è®¡ç®—ç›®æ ‡
// ==============================
function calcTarget() {
  const gender = document.getElementById('gender').value;
  const age = parseInt(document.getElementById('age').value) || 25;
  const height = parseInt(document.getElementById('height').value) || 165;
  const weight = parseInt(document.getElementById('weight').value) || 55;
  const activity = parseFloat(document.getElementById('activity').value);
  const mode = document.getElementById('mode').value;

  state.profile = { gender, age, height, weight, activity, mode };

  let bmr;
  if (gender === 'male') {
    bmr = 10 * weight + 6.25 * height - 5 * age + 5;
  } else {
    bmr = 10 * weight + 6.25 * height - 5 * age - 161;
  }
  const tdee = bmr * activity;

  let factor = 1;
  if (mode === 'lose') factor = 0.85;
  if (mode === 'gain') factor = 1.1;
  if (mode === 'pregnant') factor = 1.15;

  const targetCal = tdee * factor;

  let pro, fat;
  if (mode === 'pregnant') {
    pro = Math.round(1.2 * weight);
    fat = Math.round(0.9 * weight);
  } else {
    pro = Math.round(2.0 * weight);
    fat = Math.round(0.8 * weight);
  }
  const car = Math.round((targetCal - pro * 4 - fat * 9) / 4);

  state.target = { bmr: Math.round(bmr), tdee: Math.round(tdee), cal: Math.round(targetCal), pro, fat, car };

  state.mealSplit = {
    breakfast: Math.round(targetCal * 0.3),
    lunch: Math.round(targetCal * 0.4),
    dinner: Math.round(targetCal * 0.2),
    snack: Math.round(targetCal * 0.1)
  };

  renderTarget();
  renderMealSplit();
  calcTotal();
  saveState();
  // é‡æ–°ç”Ÿæˆå¯¹åº”æ¨¡å¼çš„é£Ÿè°±
  genRecipe();
}

function renderTarget() {
  document.getElementById('bmr').textContent = state.target.bmr;
  document.getElementById('tdee').textContent = state.target.tdee;
  document.getElementById('targetCal').textContent = state.target.cal;
  document.getElementById('targetPro').textContent = state.target.pro;
  document.getElementById('targetFat').textContent = state.target.fat;
  document.getElementById('targetCar').textContent = state.target.car;
  document.getElementById('targetCard').style.display = 'block';
  document.getElementById('totalCard').style.display = 'block';
}

function renderMealSplit() {
  document.getElementById('breakfastTarget').textContent = state.mealSplit.breakfast;
  document.getElementById('lunchTarget').textContent = state.mealSplit.lunch;
  document.getElementById('dinnerTarget').textContent = state.mealSplit.dinner;
  document.getElementById('snackTarget').textContent = state.mealSplit.snack;
  document.getElementById('mealSplitCard').style.display = 'block';
}

// ==============================
// æ·»åŠ é¤é£Ÿ
// ==============================
function addMeal(type) {
  const food = state.currentFood;
  if (!food.name || food.cal <= 0) {
    alert('è¯·å…ˆæœç´¢å¹¶å¡«å……é£Ÿç‰©è¥å…»ä¿¡æ¯');
    return;
  }
  state.foodData[type].push({ ...food });
  renderMeal(type);
  calcTotal();
  saveState();
}

function renderMeal(type) {
  const el = document.getElementById(`${type}List`);
  if (state.foodData[type].length === 0) {
    el.innerHTML = '<div style="padding:0.7rem;text-align:center;color:#999;">æš‚æ— è®°å½•</div>';
    return;
  }
  el.innerHTML = state.foodData[type].map((item, i) => `
    <div class="item">
      <span>${item.name} ${item.gram}g</span>
      <span>${item.cal}kcal</span>
      <button class="btn-mini danger" onclick="delMeal('${type}',${i})">åˆ </button>
    </div>
  `).join('');
}

function delMeal(type, idx) {
  state.foodData[type].splice(idx, 1);
  renderMeal(type);
  calcTotal();
  saveState();
}

// ==============================
// è®¡ç®—æ€»è®¡ & æ¯é¤å¯¹æ¯”
// ==============================
function calcTotal() {
  let total = { cal: 0, pro: 0, fat: 0, car: 0 };
  let mealTotal = { breakfast: 0, lunch: 0, dinner: 0, snack: 0 };

  ['breakfast', 'lunch', 'dinner', 'snack'].forEach(t => {
    state.foodData[t].forEach(item => {
      total.cal += parseInt(item.cal);
      total.pro += parseFloat(item.pro);
      total.fat += parseFloat(item.fat);
      total.car += parseFloat(item.car);
      mealTotal[t] += parseInt(item.cal);
    });
  });

  state.total = total;

  // æ¸²æŸ“æ€»æ‘„å…¥
  document.getElementById('totalCal').textContent = total.cal;
  document.getElementById('totalPro').textContent = total.pro.toFixed(1);
  document.getElementById('totalFat').textContent = total.fat.toFixed(1);
  document.getElementById('totalCar').textContent = total.car.toFixed(1);
  document.getElementById('totalCalTarget').textContent = state.target.cal;
  document.getElementById('totalProTarget').textContent = state.target.pro;
  document.getElementById('totalFatTarget').textContent = state.target.fat;
  document.getElementById('totalCarTarget').textContent = state.target.car;

  // è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”ï¼ˆä¸è¶…è¿‡100%ï¼‰
  const calPer = state.target.cal === 0 ? 0 : Math.min((total.cal / state.target.cal) * 100, 100);
  const proPer = state.target.pro === 0 ? 0 : Math.min((total.pro / state.target.pro) * 100, 100);
  const fatPer = state.target.fat === 0 ? 0 : Math.min((total.fat / state.target.fat) * 100, 100);
  const carPer = state.target.car === 0 ? 0 : Math.min((total.car / state.target.car) * 100, 100);

  // æ¸²æŸ“æ€»è¿›åº¦æ¡
  document.getElementById('totalCalPer').style.width = calPer + '%';
  document.getElementById('totalProPer').style.width = proPer + '%';
  document.getElementById('totalFatPer').style.width = fatPer + '%';
  document.getElementById('totalCarPer').style.width = carPer + '%';

  // æ¸²æŸ“æ¯é¤æ‘„å…¥
  document.getElementById('breakfastTotal').textContent = mealTotal.breakfast;
  document.getElementById('lunchTotal').textContent = mealTotal.lunch;
  document.getElementById('dinnerTotal').textContent = mealTotal.dinner;
  document.getElementById('snackTotal').textContent = mealTotal.snack;

  // æ¸²æŸ“æ¯é¤è¿›åº¦æ¡
  document.getElementById('breakfastPer').style.width = state.mealSplit.breakfast === 0 ? 0 : Math.min((mealTotal.breakfast / state.mealSplit.breakfast) * 100, 100) + '%';
  document.getElementById('lunchPer').style.width = state.mealSplit.lunch === 0 ? 0 : Math.min((mealTotal.lunch / state.mealSplit.lunch) * 100, 100) + '%';
  document.getElementById('dinnerPer').style.width = state.mealSplit.dinner === 0 ? 0 : Math.min((mealTotal.dinner / state.mealSplit.dinner) * 100, 100) + '%';
  document.getElementById('snackPer').style.width = state.mealSplit.snack === 0 ? 0 : Math.min((mealTotal.snack / state.mealSplit.snack) * 100, 100) + '%';
}

// ==============================
// æ¸…ç©ºä»Šæ—¥
// ==============================
function clearAll() {
  if (!confirm('ç¡®å®šæ¸…ç©ºä»Šæ—¥æ‰€æœ‰é¥®é£Ÿè®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤')) return;
  state.foodData = { breakfast: [], lunch: [], dinner: [], snack: [] };
  ['breakfast', 'lunch', 'dinner', 'snack'].forEach(renderMeal);
  calcTotal();
  saveState();
  alert('ä»Šæ—¥è®°å½•å·²æ¸…ç©º');
}

// ==============================
// æœ¬åœ°å­˜å‚¨
// ==============================
function saveState() {
  localStorage.setItem('foodState', JSON.stringify(state));
}

function loadState() {
  const s = localStorage.getItem('foodState');
  if (s) state = JSON.parse(s);
  // å›æ˜¾ä¸ªäººä¿¡æ¯
  document.getElementById('gender').value = state.profile.gender;
  document.getElementById('age').value = state.profile.age;
  document.getElementById('height').value = state.profile.height;
  document.getElementById('weight').value = state.profile.weight;
  document.getElementById('activity').value = state.profile.activity;
  document.getElementById('mode').value = state.profile.mode;
  // æ¸²æŸ“æ•°æ®
  renderTarget();
  renderMealSplit();
  ['breakfast', 'lunch', 'dinner', 'snack'].forEach(renderMeal);
  calcTotal();
  renderFav();
}

// ==============================
// ä½“é‡è®°å½• - ä¼˜åŒ–ç©ºæ•°æ®å±•ç¤º
// ==============================
function saveWeight() {
  const w = parseFloat(document.getElementById('todayWeight').value);
  if (!w || w < 20 || w > 300) {
    alert('è¯·è¾“å…¥æœ‰æ•ˆä½“é‡ï¼ˆ20-300kgï¼‰ï¼Œæ”¯æŒå°æ•°ç‚¹å1ä½');
    return;
  }
  const now = new Date();
  const date = now.toISOString().split('T')[0];
  const list = state.weightList;
  const idx = list.findIndex(item => item.date === date);
  if (idx >= 0) list[idx].weight = w;
  else list.push({ date, weight: w });
  // æŒ‰æ—¥æœŸæ’åºï¼Œä¿ç•™è¿‘30å¤©
  list.sort((a, b) => new Date(a.date) - new Date(b.date));
  if (list.length > 30) list.splice(0, list.length - 30);
  state.weightList = list;
  localStorage.setItem('weightList', JSON.stringify(list));
  document.getElementById('todayWeight').value = '';
  renderWeightHistory();
  drawWeightChart();
  alert('ä½“é‡ä¿å­˜æˆåŠŸ');
}

function renderWeightHistory() {
  const el = document.getElementById('weightHistory');
  if (state.weightList.length === 0) {
    el.innerHTML = '<div style="padding:0.7rem;text-align:center;color:#999;">æš‚æ— ä½“é‡è®°å½•ï¼Œæ·»åŠ åè‡ªåŠ¨å±•ç¤ºè¶‹åŠ¿å’Œå†å²</div>';
    return;
  }
  el.innerHTML = state.weightList.map(item => `
    <div class="history-item">
      <span>${item.date}</span>
      <span>${item.weight} kg</span>
    </div>
  `).join('');
}

function drawWeightChart() {
  const list = state.weightList;
  const ctx = document.getElementById('weightChart').getContext('2d');
  // æ¸…ç©ºç”»å¸ƒ
  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  // æ— æ•°æ®/å•æ¡æ•°æ®ä¸æ¸²æŸ“æŠ˜çº¿
  if (list.length < 2) {
    ctx.fillStyle = '#999';
    ctx.font = '0.95rem PingFang SC';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('è‡³å°‘æ·»åŠ 2æ¡ä½“é‡è®°å½•ä»¥å±•ç¤ºè¶‹åŠ¿', ctx.canvas.width/2, ctx.canvas.height/2);
    return;
  }
  // å›¾è¡¨ç»˜åˆ¶é€»è¾‘
  const weights = list.map(i => i.weight);
  const minW = Math.min(...weights);
  const maxW = Math.max(...weights);
  const range = maxW - minW || 1;
  const pad = 30;
  const w = ctx.canvas.width;
  const h = ctx.canvas.height;

  ctx.strokeStyle = '#ff7b9c';
  ctx.fillStyle = '#ff7b9c';
  ctx.lineWidth = 2.5;
  ctx.beginPath();
  list.forEach((item, i) => {
    const x = pad + (w - 2 * pad) * (i / (list.length - 1));
    const y = h - pad - ((item.weight - minW) / range) * (h - 2 * pad);
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
    // ç»˜åˆ¶æ•°æ®ç‚¹
    ctx.beginPath();
    ctx.arc(x, y, 3.5, 0, Math.PI * 2);
    ctx.fill();
    ctx.beginPath();
    ctx.moveTo(x, y);
  });
  ctx.stroke();
}

// ==============================
// è¥å…»åˆ†ææŠ¥å‘Š
// ==============================
function genReport() {
  const t = state.target;
  const total = state.total;
  if (t.cal === 0) {
    document.getElementById('reportContent').textContent = 'è¯·å…ˆåœ¨ã€é¥®é£Ÿè®°å½•ã€‘æ ‡ç­¾ä¸­è®¡ç®—ä¸ªäººæ¨èè¥å…»ç›®æ ‡';
    return;
  }
  if (total.cal === 0) {
    document.getElementById('reportContent').textContent = 'è¯·å…ˆè®°å½•ä»Šæ—¥é¥®é£Ÿï¼Œå†ç”Ÿæˆè¥å…»åˆ†ææŠ¥å‘Š';
    return;
  }
  const calPct = Math.round((total.cal / t.cal) * 100);
  const proPct = Math.round((total.pro / t.pro) * 100);
  const fatPct = Math.round((total.fat / t.fat) * 100);
  const carPct = Math.round((total.car / t.car) * 100);

  let advice = '';
  if (calPct < 80) advice = 'ä»Šæ—¥çƒ­é‡æ‘„å…¥åä½ï¼Œå¯é€‚å½“å¢åŠ ä¸»é£Ÿæˆ–ä¼˜è´¨è›‹ç™½ï¼Œé¿å…åŸºç¡€ä»£è°¢ä¸‹é™ã€‚';
  else if (calPct > 120) advice = 'ä»Šæ—¥çƒ­é‡æ‘„å…¥åé«˜ï¼Œå»ºè®®å‡å°‘ç²¾åˆ¶ç¢³æ°´ä¸æ²¹ç‚¸é£Ÿå“ï¼Œå¢åŠ ç»¿å¶è”¬èœæ¯”ä¾‹ã€‚';
  else advice = 'ä»Šæ—¥çƒ­é‡æ‘„å…¥åˆç†ï¼Œç»§ç»­ä¿æŒå½“å‰é¥®é£ŸèŠ‚å¥ã€‚';

  if (proPct < 70) advice += '\nè›‹ç™½è´¨æ‘„å…¥ä¸è¶³ï¼Œå»ºè®®å¢åŠ é¸¡èƒ¸è‚‰ã€é±¼è™¾ã€é¸¡è›‹ã€è±†åˆ¶å“ç­‰ä¼˜è´¨è›‹ç™½ã€‚';
  if (fatPct < 70) advice += '\nå¥åº·è„‚è‚ªæ‘„å…¥åä½ï¼Œå¯é€‚é‡å¢åŠ åšæœã€æ©„æ¦„æ²¹ã€æ·±æµ·é±¼ç­‰ã€‚';
  if (carPct < 70) advice += '\nç¢³æ°´æ‘„å…¥åä½ï¼Œå¯å¢åŠ å…¨è°·ç‰©ã€è–¯ç±»ç­‰å¤åˆç¢³æ°´ï¼Œä¿è¯èº«ä½“ä¾›èƒ½ã€‚';
  if (proPct > 130) advice += '\nè›‹ç™½è´¨æ‘„å…¥åé«˜ï¼Œè‹¥æ— å¢è‚Œéœ€æ±‚å¯é€‚å½“å‡å°‘ï¼Œå‡è½»è‚¾è„ä»£è°¢è´Ÿæ‹…ã€‚';
  if (fatPct > 130) advice += '\nè„‚è‚ªæ‘„å…¥åé«˜ï¼Œå»ºè®®å‡å°‘åŠ¨ç‰©è„‚è‚ªå’Œæ²¹ç‚¸é£Ÿå“ï¼Œé€‰æ‹©æ¤ç‰©æ²¹çƒ¹é¥ªã€‚';
  if (carPct > 130) advice += '\nç¢³æ°´æ‘„å…¥åé«˜ï¼Œå»ºè®®å‡å°‘ç²¾åˆ¶ç±³é¢ï¼Œæ›¿æ¢ä¸ºå…¨è°·ç‰©å’Œè–¯ç±»ã€‚';

  const report = `
ã€ä»Šæ—¥è¥å…»åˆ†ææŠ¥å‘Šã€‘
ğŸ“Š æ‘„å…¥å æ¯”ï¼ˆå®é™…/ç›®æ ‡ï¼‰ï¼š
çƒ­é‡ï¼š${total.cal} / ${t.cal} kcalï¼ˆ${calPct}%ï¼‰
è›‹ç™½è´¨ï¼š${total.pro.toFixed(1)} / ${t.pro} gï¼ˆ${proPct}%ï¼‰
è„‚è‚ªï¼š${total.fat.toFixed(1)} / ${t.fat} gï¼ˆ${fatPct}%ï¼‰
ç¢³æ°´ï¼š${total.car.toFixed(1)} / ${t.car} gï¼ˆ${carPct}%ï¼‰

ğŸ’¡ ä¸ªæ€§åŒ–é¥®é£Ÿå»ºè®®ï¼š
${advice || 'ä»Šæ—¥å„é¡¹è¥å…»æ‘„å…¥å‡è¡¡ï¼Œç»§ç»­ä¿æŒå¥åº·çš„é¥®é£Ÿä¹ æƒ¯ï¼'}

ğŸ“– ä¸­å›½å±…æ°‘è†³é£ŸæŒ‡å— 2022 æ ¸å¿ƒè¦ç‚¹ï¼š
â€¢ è°·è–¯ç±»å æ¯æ—¥ä¸»é£Ÿ 50% ä»¥ä¸Šï¼Œå¤šåƒå…¨è°·ç‰©
â€¢ æ¯æ—¥è”¬èœæ‘„å…¥é‡ â‰¥ 500gï¼Œæ·±è‰²è”¬èœå ä¸€åŠä»¥ä¸Š
â€¢ æ¯æ—¥å¥¶ç±» 300-500gï¼Œè¡¥å……é’™è´¨
â€¢ æ¯å‘¨åƒé±¼ â‰¥ 2 æ¬¡ï¼Œæ‘„å…¥ä¼˜è´¨è›‹ç™½å’ŒDHA
â€¢ æ¯æ—¥æ§æ²¹ 25-30gï¼Œæ·»åŠ ç³–æ‘„å…¥é‡ â‰¤ 25g
  `;
  document.getElementById('reportContent').textContent = report;
}

// ==============================
// ä¸ªæ€§åŒ–æ™ºèƒ½é£Ÿè°±æ¨èï¼ˆå‡è„‚/å¢è‚Œ/ç»´æŒ/å­•å¦‡ï¼‰
// ==============================
function genRecipe() {
  const mode = state.profile.mode;
  let recipes = [];

  if (mode === 'lose') {
    recipes = [
      {
        name: 'ğŸ¥£ å‡è„‚æ—©é¤ï¼šå…¨éº¦åå¸+æ°´ç…®è›‹+æ— ç³–é…¸å¥¶',
        desc: 'å…¨éº¦åå¸1ç‰‡ + æ°´ç…®è›‹1ä¸ª + æ— ç³–é…¸å¥¶150g + å°ç•ªèŒ„5é¢—ï¼Œçƒ­é‡â‰ˆ350kcalï¼Œé«˜è›‹ç™½é«˜çº¤ç»´ï¼Œé¥±è…¹æ„Ÿå¼ºï¼Œå»¶ç¼“é¥¥é¥¿ã€‚'
      },
      {
        name: 'ğŸ± å‡è„‚åˆé¤ï¼šæ‚ç²®é¥­+é¦™ç…é¸¡èƒ¸è‚‰+æ¸…ç‚’è¥¿å…°èŠ±',
        desc: 'æ‚ç²®é¥­100g + é¦™ç…é¸¡èƒ¸è‚‰120gï¼ˆæ— æ²¹ï¼‰ + æ¸…ç‚’è¥¿å…°èŠ±200gï¼Œçƒ­é‡â‰ˆ500kcalï¼Œè›‹ç™½è´¨å……è¶³ï¼Œç¢³æ°´é€‚ä¸­ï¼Œæ»¡è¶³åˆé¤ä¾›èƒ½ã€‚'
      },
      {
        name: 'ğŸ² å‡è„‚æ™šé¤ï¼šè±†è…è”¬èœæ±¤+å°çº¢è–¯',
        desc: 'å«©è±†è…150g + è èœ150g + èŒè‡50gç…®æ±¤ + å°çº¢è–¯150gï¼Œçƒ­é‡â‰ˆ300kcalï¼Œæ¸…æ·¡ä½å¡ï¼Œé«˜çº¤ç»´ï¼Œç¡å‰æ— è´Ÿæ‹…ã€‚'
      },
      {
        name: 'ğŸ å‡è„‚åŠ é¤ï¼šè‹¹æœ+æä»5é¢—',
        desc: 'ä¸­ç­‰è‹¹æœ1ä¸ª + åŸå‘³æä»5é¢—ï¼Œçƒ­é‡â‰ˆ120kcalï¼Œè¡¥å……ç»´ç”Ÿç´ å’Œå¥åº·è„‚è‚ªï¼Œé¿å…æ­£é¤è¿‡é‡è¿›é£Ÿã€‚'
      }
    ];
  } else if (mode === 'gain') {
    recipes = [
      {
        name: 'ğŸ¥£ å¢è‚Œæ—©é¤ï¼šç‡•éº¦+ç‰›å¥¶+å…¨è›‹+åšæœ',
        desc: 'çº¯ç‡•éº¦50g + å…¨è„‚ç‰›å¥¶300ml + æ°´ç…®å…¨è›‹2ä¸ª + åŸå‘³æä»10gï¼Œçƒ­é‡â‰ˆ550kcalï¼Œé«˜è›‹ç™½+ä¼˜è´¨å¤åˆç¢³æ°´ï¼Œä¸ºå¢è‚Œæä¾›åŸºç¡€ã€‚'
      },
      {
        name: 'ğŸ± å¢è‚Œåˆé¤ï¼šç³™ç±³é¥­+ç˜¦ç‰›è‚‰+å½©æ¤’ç‚’è¥¿å…°èŠ±',
        desc: 'ç³™ç±³é¥­150g + ç˜¦ç‰›è‚‰150g + å½©æ¤’50g+è¥¿å…°èŠ±200gï¼Œçƒ­é‡â‰ˆ650kcalï¼Œè¶³é‡ä¼˜è´¨è›‹ç™½+å¤åˆç¢³æ°´ï¼Œæ”¯æ’‘è‚Œè‚‰åˆæˆã€‚'
      },
      {
        name: 'ğŸ² å¢è‚Œæ™šé¤ï¼šä¸‰æ–‡é±¼+çƒ¤åœŸè±†+æ¸…ç‚’èŠ¦ç¬‹',
        desc: 'ä¸‰æ–‡é±¼150g + çƒ¤åœŸè±†200g + æ¸…ç‚’èŠ¦ç¬‹150gï¼Œçƒ­é‡â‰ˆ600kcalï¼Œä¼˜è´¨è„‚è‚ª+é«˜è›‹ç™½ï¼Œä¿ƒè¿›è®­ç»ƒåè‚Œè‚‰æ¢å¤ã€‚'
      },
      {
        name: 'ğŸ¥› å¢è‚ŒåŠ é¤ï¼šæ— ç³–é…¸å¥¶+é¦™è•‰',
        desc: 'æ— ç³–é…¸å¥¶200g + é¦™è•‰1æ ¹ï¼Œçƒ­é‡â‰ˆ250kcalï¼Œå¿«é€Ÿè¡¥å……ç¢³æ°´å’Œè›‹ç™½ï¼Œé€‚åˆè®­ç»ƒååŠ é¤ã€‚'
      }
    ];
  } else if (mode === 'pregnant') {
    recipes = [
      {
        name: 'ğŸ¥£ å­•å¦‡æ—©é¤ï¼šå°ç±³ç²¥+é¸¡è›‹+ç‰›å¥¶+è‹¹æœ',
        desc: 'å°ç±³ç²¥1ç¢—ï¼ˆçº¦100gï¼‰ + æ°´ç…®è›‹1ä¸ª + çº¯ç‰›å¥¶250ml + ä¸­ç­‰è‹¹æœ1ä¸ªï¼Œæ¸©å’Œæ˜“æ¶ˆåŒ–ï¼Œè¡¥é“è¡¥é’™è¡¥å¶é…¸ï¼Œæ»¡è¶³å­•æœŸåŸºç¡€è¥å…»ã€‚'
      },
      {
        name: 'ğŸ± å­•å¦‡åˆé¤ï¼šæ‚ç²®é¥­+æ¸…è’¸é²ˆé±¼+æ¸…ç‚’è èœ',
        desc: 'æ‚ç²®é¥­100g + æ¸…è’¸é²ˆé±¼150g + æ¸…ç‚’è èœ200gï¼Œä¼˜è´¨è›‹ç™½+DHA+é“å…ƒç´ ï¼Œå­•æœŸèƒå„¿å‘è‚²å¿…å¤‡è¥å…»ï¼Œæ¸…æ·¡æ— åˆºæ¿€ã€‚'
      },
      {
        name: 'ğŸ² å­•å¦‡æ™šé¤ï¼šè™¾ä»è±†è…+è¥¿å…°èŠ±+å°çº¢è–¯',
        desc: 'é²œè™¾ä»100g + å«©è±†è…150g + æ¸…ç‚’è¥¿å…°èŠ±150g + å°çº¢è–¯150gï¼Œè¡¥é’™è¡¥é“è¡¥è›‹ç™½ï¼Œæ¸…æ·¡è¥å…»ï¼Œå‡è½»å­•æœŸè‚ èƒƒè´Ÿæ‹…ã€‚'
      },
      {
        name: 'ğŸ“ å­•å¦‡åŠ é¤ï¼šåŸå‘³é…¸å¥¶+è‰è“',
        desc: 'åŸå‘³é…¸å¥¶150g + è‰è“10é¢—ï¼Œçƒ­é‡â‰ˆ150kcalï¼Œè¡¥é’™+ç»´ç”Ÿç´ Cï¼Œä¿ƒè¿›é“å¸æ”¶ï¼Œç¼“è§£å­•æœŸä¾¿ç§˜ã€‚'
      }
    ];
  } else {
    // maintain æ—¥å¸¸ç»´æŒ
    recipes = [
      {
        name: 'ğŸ¥£ ç»´æŒæ—©é¤ï¼šç‡•éº¦ç²¥+æ°´ç…®è›‹+å°ç•ªèŒ„',
        desc: 'çº¯ç‡•éº¦50gç…®åˆ¶ + æ°´ç…®è›‹1ä¸ª + å°ç•ªèŒ„5é¢—ï¼Œçƒ­é‡â‰ˆ400kcalï¼Œå‡è¡¡è¥å…»ï¼Œç¨³å®šè¡€ç³–ï¼Œå¼€å¯æ´»åŠ›ä¸€å¤©ã€‚'
      },
      {
        name: 'ğŸ± ç»´æŒåˆé¤ï¼šç³™ç±³é¥­+ç˜¦ç‰›è‚‰+è¥¿å…°èŠ±ç‚’èƒ¡èåœ',
        desc: 'ç³™ç±³é¥­120g + ç˜¦ç‰›è‚‰120g + è¥¿å…°èŠ±150g+èƒ¡èåœ50gï¼Œçƒ­é‡â‰ˆ550kcalï¼Œå‡è¡¡ä¾›èƒ½ï¼Œä¸èƒ–ä¸ç˜¦ï¼Œé€‚åˆæ—¥å¸¸å·¥ä½œã€‚'
      },
      {
        name: 'ğŸ² ç»´æŒæ™šé¤ï¼šé¸¡èƒ¸è‚‰è”¬èœæ²™æ‹‰+å°çº¢è–¯',
        desc: 'é¸¡èƒ¸è‚‰100g + æ··åˆè”¬èœ200gï¼ˆç”Ÿèœ/ç´«ç”˜è“/é»„ç“œï¼‰ + å°çº¢è–¯150gï¼Œçƒ­é‡â‰ˆ400kcalï¼Œæ¸…æ·¡å‡è¡¡ï¼Œé¥±è…¹æ„Ÿå¼ºã€‚'
      },
      {
        name: 'ğŸ¥œ ç»´æŒåŠ é¤ï¼šåŸå‘³åšæœ5é¢—+æ©™å­',
        desc: 'åŸå‘³æ··åˆåšæœ5é¢— + ä¸­ç­‰æ©™å­1ä¸ªï¼Œçƒ­é‡â‰ˆ150kcalï¼Œè¡¥å……å¥åº·è„‚è‚ªä¸ç»´ç”Ÿç´ ï¼Œç¼“è§£ä¸‹åˆé¥¥é¥¿ã€‚'
      }
    ];
  }

  document.getElementById('recipeList').innerHTML = recipes.map(r => `
    <div class="recipe-item">
      <h3>${r.name}</h3>
      <p>${r.desc}</p>
    </div>
  `).join('');
}
</script>

</body>
</html>
